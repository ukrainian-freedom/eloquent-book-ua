# JavaScript та браузер

{{quote {author: «Tim Berners-Lee», title: «The World Wide Web: A Very Short Personal Pistory», chapter: true}}

Мрія, що стоїть за павутиною, - це спільний інформаційний простір, в якому ми спілкуємося, обмінюючись інформацією. Його універсальність має важливе значення: той факт, що гіпертекстове посилання може вказувати на будь-що, будь то особисте, локальне чи глобальне, будь то чернетка чи відшліфована версія.

quote}}
{{index «Бернерс-Лі, Тім», «Всесвітня павутина», HTTP, [JavaScript, «історія»], «Всесвітня павутина»}}

{{figure {url: «img/chapter_picture_13.jpg», alt: «Ілюстрація із зображенням телефонного комутатора», »chapter: «Обрамлення"}}}}

У наступних розділах цієї книги мова піде про веб-браузери. Без ((браузерів)) не було б JavaScript - а якби й був, ніхто б ніколи не звернув на нього уваги.

{Децентралізація, сумісність

Веб-технологія була децентралізованою від самого початку, не лише технічно, але й з точки зору способу її розвитку. Різні виробники браузерів додавали нову функціональність спеціальними, а іноді і непродуманими способами, які потім - іноді - переймалися іншими, і врешті-решт були закріплені у ((стандартах)).

Це і благословення, і прокляття. З одного боку, це розширює можливості, коли система не контролюється центральною партією, а вдосконалюється різними партіями, які працюють у вільній ((співпраці)) (а іноді й у відкритій ворожнечі). З іншого боку, безсистемний спосіб, у який розроблявся веб, означає, що отримана система не є блискучим прикладом внутрішньої ((узгодженості)). Деякі її частини є відверто заплутаними і погано спроектованими.

## Мережі та Інтернет

Комп'ютерні мережі існують з 1950-х років. Якщо ви прокладете кабелі між двома чи більше комп'ютерами і дозволите їм пересилати дані туди-сюди через ці кабелі, ви зможете робити безліч чудових речей.

Якщо з'єднання двох комп'ютерів в одній будівлі дозволяє нам робити чудові речі, то з'єднання комп'ютерів по всій планеті має бути ще кращим. Технологія, яка дозволила почати реалізовувати це бачення, була розроблена у 1980-х роках, а створена в результаті мережа отримала назву _((Інтернет))_. Вона виправдала покладені на неї сподівання.

Комп'ютер може використовувати цю мережу, щоб стріляти бітами в інший комп'ютер. Для того, щоб з цього обміну бітами міг виникнути ефективний зв'язок, комп'ютери на обох кінцях мережі повинні знати, що ці біти мають означати. Значення будь-якої послідовності бітів повністю залежить від того, що саме вона намагається виразити, і від використовуваного механізму кодування.

{{індекс [мережі, протоколу]}}

Мережевий ((протокол))_ описує стиль спілкування у ((мережі)). Існують протоколи для надсилання електронної пошти, отримання електронної пошти, обміну файлами і навіть для керування комп'ютерами, які випадково були заражені шкідливим програмним забезпеченням.

{{див. «Протокол передачі гіпертексту», HTTP}}

Протокол_передачі_гіпертексту_ (((HTTP)) - це протокол для отримання іменованих ((ресурсів)) (фрагментів інформації, таких як веб-сторінки або зображення). Він визначає, що сторона, яка робить запит, повинна починати його з такого рядка, називаючи ресурс і версію протоколу, яку вона намагається використати:

```{lang: http}
GET /index.html HTTP/1.1
```

Існує ще багато правил про те, як запитувач може включити більше інформації в ((запит)) і як інша сторона, яка повертає ресурс, упаковує його вміст. Ми розглянемо HTTP більш детально у [Розділі ?](http).

{{Розшарування індексів, потік, впорядкування}}

Більшість протоколів побудовано на основі інших протоколів. HTTP розглядає мережу як потоковий пристрій, у який ви можете передавати біти і чекати, що вони прибудуть до місця призначення у правильному порядку. Забезпечення цих гарантій на додаток до примітивного надсилання даних, які надає вам мережа, вже є досить складною проблемою.

{{index TCP}}

{{indexsee «Протокол керування передаванням», TCP}}

Протокол керування передаванням (TCP) - це протокол, який вирішує цю проблему. Усі пристрої, підключені до інтернету, «розмовляють» ним, і більшість комунікацій в інтернеті побудовано на його основі.

{{index «listening (TCP)»}}

TCP-з'єднання працює наступним чином: один комп'ютер повинен чекати, або _слухати_, коли інші комп'ютери почнуть з ним розмовляти. Щоб мати можливість слухати різні види зв'язку одночасно на одному комп'ютері, кожен слухач має номер (який називається _((порт))_), пов'язаний з ним. Більшість ((протоколів)) визначають, який порт слід використовувати за замовчуванням. Наприклад, коли ми хочемо надіслати електронного листа за допомогою протоколу ((SMTP)), очікується, що комп'ютер, через який ми його надсилаємо, слухатиме порт 25.

Інший комп'ютер може встановити з'єднання, підключившись до цільового комп'ютера, використовуючи правильний номер порту. Якщо цільовий комп'ютер доступний і прослуховує цей порт, з'єднання буде успішно встановлено. Комп'ютер, що слухає, називається _((сервер))_, а комп'ютер, що підключається, називається _((клієнт))_.

{{index [абстракція, «мережі»]}}

Таке з'єднання діє як двостороння ((труба)), якою можуть текти біти - комп'ютери на обох кінцях можуть поміщати в неї дані. Після того, як біти успішно передані, вони можуть бути знову зчитані машиною на іншій стороні. Це зручна модель. Можна сказати, що ((TCP)) надає абстракцію мережі.

{{id web}}

## The Web

Всесвітня павутина (не плутати з Інтернетом в цілому) - це набір ((протоколів)) і форматів, які дозволяють нам відвідувати веб-сторінки у браузері. Слово _Веб_ вказує на те, що такі сторінки можуть легко посилатися одна на одну, об'єднуючись таким чином у величезну ((мережу)), якою користувачі можуть переміщатися.

Щоб стати частиною павутини, все, що вам потрібно зробити, це підключити комп'ютер до Інтернету і налаштувати його на прослуховування порту 80 за протоколом (HTTP), щоб інші комп'ютери могли запитувати у нього документи.

{{index URL}}

{{indexsee «уніфікований локатор ресурсів», URL}}

Кожен ((документ)) в Інтернеті називається за допомогою _уніфікованого локатора ресурсів_ (URL), який виглядає приблизно так:

```{lang: null}
  http://eloquentjavascript.net/13_browser.html
 
 шлях до сервера протоколу
```

{{index HTTPS}}

Перша частина говорить нам про те, що ця URL-адреса використовує протокол HTTP (на відміну від, наприклад, зашифрованого HTTP, який мав би вигляд _https://_). Далі йде частина, яка визначає, з якого ((сервера)) ми запитуємо документ. І нарешті, рядок шляху, який ідентифікує документ (або _((ресурс))_), який нас цікавить.

Комп'ютери, підключені до Інтернету, отримують _((IP-адресу))_, число, яке можна використовувати для надсилання повідомлень на цей комп'ютер, і яке виглядає приблизно так: `149.210.142.219` або `2001:4860:4860::8888`. Оскільки списки більш-менш випадкових чисел важко запам'ятати і незручно вводити, ви можете замість цього зареєструвати _((доменне)) ім'я_ для адреси або набору адрес. Я зареєстрував _eloquentjavascript.net_, щоб вказати на IP-адресу комп'ютера, яким я керую, і таким чином можу використовувати це доменне ім'я для обслуговування веб-сторінок.

{{індекс браузера}}

Якщо ви введете цю URL-адресу в адресний рядок вашого браузера, браузер спробує знайти і відобразити ((документ)) за цією адресою. Спочатку браузер має з'ясувати, на яку адресу посилається _eloquentjavascript.net_. Потім, використовуючи протокол ((HTTP)), він встановить з'єднання з сервером за цією адресою і запросить ресурс _/13_browser.html_. Якщо все пройшло успішно, сервер повертає документ, який потім відображається на екрані вашого браузера.

## HTML

{{index HTML}}

{{indexsee «HyperText Markup Language», HTML}}

HTML_, що розшифровується як HyperText Markup Language (мова розмітки гіпертексту), є форматом документа, який використовується для веб-сторінок. Документ HTML містить ((текст)), а також _((теги))_, які надають тексту структуру, описуючи такі речі, як посилання, абзаци та заголовки.

Короткий HTML-документ може мати такий вигляд:

```{lang: «html"}
<!doctype html>
<html>
  <head>
    <meta charset=«utf-8»>
    <title>Моя домашня сторінка</title>
  </ head> </ head> </ head> </ head> </ head> </ head> </ head> </ head
  <body>
    <h1>Моя домашня сторінка</h1>
    <p>Привіт, мене звуть Марін, і це моя домашня сторінка.
    <А ще я написала книгу! Прочитайте її
      <a href=«http://eloquentjavascript.net»>тут</a>.</p>
  </p> <p>
</html>
```

{{if book

Ось як такий документ виглядатиме у браузері:

{{figure {url: «img/home-page.png», alt: «Відрендерена версія прикладу HTML домашньої сторінки»,width: “6.3cm”}}}}

if}}

{{індекс [HTML, нотація]}}

Теги, загорнуті у ((кутові дужки)) (`<` і `>`, символи для _менше ніж_ і _більше ніж_), надають інформацію про ((структуру)) документа. Решта ((текст)) є звичайним текстом.

{{індекс доктрини, версія}}

Документ починається з `<!doctype html>`, що вказує браузеру інтерпретувати сторінку як _сучасний_ HTML, на відміну від застарілих стилів, що використовувалися у минулому.

{{index «head (HTML-тег)», «body (HTML-тег)», «title (HTML-тег)», «h1 (HTML-тег)», «p (HTML-тег)»}}

HTML-документи складаються із заголовка та тіла. У заголовку міститься інформація _про_ документ, а в тілі - сам документ. У цьому випадку в заголовку оголошується, що цей документ називається «Моя домашня сторінка» і що він використовує кодування UTF-8, яке є способом кодування тексту Unicode у вигляді двійкових даних. Тіло документа містить заголовок (`<h1>`, що означає «заголовок 1» - `<h2>` до `<h6>` створюють підзаголовки) і два ((абзаци)) (`<p>`).

{{index «href attribute», «a (HTML-тег)»}}

Теги бувають декількох видів. ((елемент)), такий як тіло, абзац або посилання, починається з _((відкриваючий тег))_ як `<p>` і закінчується _((закриваючий тег))_ як `</p>`. Деякі відкриваючі теги, наприклад, тег ((посилання)) (`<a>`), містять додаткову інформацію у вигляді пар `назва=«значення»`. Вони називаються _((атрибут))s_. У цьому випадку місце призначення посилання вказується за допомогою `href=«http://eloquentjavascript.net»`, де `href` означає «гіпертекстове посилання».

{{index «атрибут src», «самозакривний тег», «img (HTML-тег)»}}

Деякі види ((тегів)) нічого не містять і тому їх не потрібно закривати. Прикладом цього є тег метаданих `<meta charset=«utf-8»>`.

{{index [escape, «in HTML»]}}

Щоб мати змогу включати ((кутові дужки)) у текст документа, навіть якщо вони мають спеціальне значення у HTML, необхідно ввести ще одну форму спеціальних позначень. Звичайна відкриваюча кутова дужка записується як `&lt;` («менше ніж»), а закриваюча дужка записується як `&gt;` («більше ніж»). У HTML символ амперсанду (`&`), за яким слідує ім'я або код символу і крапка з комою (`;`), називається _((об'єкт))_ і буде замінений символом, який він кодує.

{{index [«символ зворотної косої риски», «у рядках»], «символ амперсанду», «символ подвійних лапок»}}

Це аналогічно тому, як використовується зворотна коса риска у рядках JavaScript. Оскільки цей механізм також надає символам амперсанду особливого значення, їх слід екранувати як `&amp;`. Всередині значень атрибутів, які взято у подвійні лапки, `&quot;` можна використовувати для вставки буквального символу лапок.

{{індекс «толерантність до помилок», розбір}}

HTML розбирається напрочуд толерантно до помилок. Коли теги, які мають бути присутніми, відсутні, браузер автоматично додає їх. Спосіб, у який це робиться, стандартизовано, і ви можете покладатися на те, що всі сучасні браузери роблять це однаково.

Наступний документ буде оброблятися так само, як і попередній:

```{lang: «html"}
<!doctype html>

<meta charset=utf-8>
<title>Моя домашня сторінка</title>

<h1>Моя домашня сторінка</h1>
<p>Привіт, мене звати Марін, і це моя домашня сторінка.
<А ще я написала книгу! Прочитайте її
  <a href=http://eloquentjavascript.net>тут</a>.
```

{{index «title (HTML-тег)», «head (HTML-тег)», «body (HTML-тег)», «html (HTML-тег)»}}

Теги `<html>`, `<head>` і `<body>` повністю зникли. Браузер знає, що `<meta>` і `<title>` належать до заголовка, а `<h1>` означає, що почалося тіло. Крім того, я більше не закриваю абзаци явно, оскільки відкриття нового абзацу або завершення документа закриває їх неявно. Також зникли лапки навколо значень атрибутів.

У цій книзі у прикладах зазвичай не використовуються теги `<html>`, `<head>` і `<body>`, щоб зробити їх короткими і не захаращеними. Однак я _закрию_ теги і включу лапки навколо атрибутів.

{{індекс браузера}}

Зазвичай я також опускатиму оголошення ((doctype)) і `charset`. Не сприймайте це як заохочення до їх вилучення з HTML-документів. Браузери часто роблять безглузді речі, коли ви їх забуваєте. Вважайте, що метадані doctype і `charset` неявно присутні у прикладах, навіть якщо вони не показані у тексті.

{{id script_tag}}

## HTML та JavaScript

{{index [JavaScript, «у HTML»], «скрипт (тег HTML)»}}

У контексті цієї книги найважливішим тегом HTML є тег `<script>`, який дозволяє включити в документ фрагмент JavaScript.

```{lang: «html"}}
<h1>Тестувальне попередження</h1>
<script>alert(«hello!»);</script>
```

{{index «alert function», timeline}}

Такий скрипт буде запущено, як тільки браузер зустріне його тег `<script>` під час читання HTML. При відкритті цієї сторінки з'явиться діалогове вікно - функція `alert` схожа на `prompt`, у тому сенсі, що вона відкриває маленьке вікно, але показує лише повідомлення без запиту на введення.

{{index «src attribute»}}

Включення великих програм безпосередньо у HTML-документи часто є недоцільним. Тегу `<script>` можна надати атрибут src`, щоб отримати файл сценарію (текстовий файл, що містить програму на JavaScript) з URL-адреси.

```{lang: «html"}
<h1>Повідомлення про тестування</h1>
<script src=«code/hello.js»></script>
```

Файл _code/hello.js_, включений сюди, містить ту саму програму - `alert(«hello!»)`. Коли HTML-сторінка посилається на інші URL-адреси, такі як файл зображення або скрипт, веб-браузери негайно отримують їх і включають у сторінку.

{{index «script (HTML-тег)», «закриваючий тег»}}

Тег script завжди повинен закриватися `</script>`, навіть якщо він посилається на файл скрипта і не містить ніякого коду. Якщо ви забудете про це, решта сторінки буде інтерпретуватися як частина скрипта.

{{індекс «відносний шлях», залежність}}

Ви можете завантажити ((модулі ES)) (див. [Глава ?](модулі#es)) у браузері, надавши тегу вашого скрипту атрибут `type=«module»`. Такі модулі можуть залежати від інших модулів, використовуючи ((URL))и відносно себе як імена модулів в оголошеннях `import`.

{{index «кнопка (HTML-тег)», «атрибут натискання»}}

Деякі атрибути також можуть містити програму на JavaScript. Тег `<button>` (який відображається як кнопка) підтримує атрибут `onclick`. Значення атрибута буде виконуватися щоразу, коли буде натиснуто кнопку.

```{lang: «html"}
<button onclick=«alert(“Boom!”);»>НЕ НАТИСКАТИ</button>
```

{{index «символ в одинарних лапках», [escaping, «in HTML»]}}

Зауважте, що для рядка в атрибуті `onclick` мені довелося використати одинарні лапки, оскільки для всього атрибута вже використано подвійні лапки. Я також міг би використати `&quot;` для уникнення внутрішніх лапок.

## У пісочниці

{{index «malicious script», «World Wide Web», браузер, сайт, безпека}}

Запуск програм, завантажених з ((Інтернету)), є потенційно небезпечним. Ви мало знаєте про людей, які стоять за більшістю сайтів, які ви відвідуєте, і вони не обов'язково мають добрі наміри. Запуск програм зловмисниками може призвести до зараження комп'ютера вірусом, викрадення даних та зламу облікових записів.

Проте привабливість Інтернету полягає в тому, що ви можете переглядати його, не обов'язково довіряючи всім сторінкам, які ви відвідуєте. Саме тому браузери суворо обмежують можливості програми на JavaScript: вона не може переглядати файли на вашому комп'ютері або змінювати будь-що, що не пов'язане з веб-сторінкою, в яку її було вбудовано.

{Ізоляція індексів

Ізоляція середовища програмування у такий спосіб називається _((пісочниця))ing_, ідея полягає в тому, що програма нешкідливо грається у пісочниці. Але ви повинні уявити собі цей вид пісочниці як клітку з товстих сталевих прутів над нею, щоб програми, які граються в ній, насправді не могли вийти.

Складність пісочниці полягає в тому, щоб надати програмам достатньо простору для корисної роботи, водночас не даючи їм робити нічого небезпечного. Багато корисних функцій, таких як зв'язок з іншими серверами або читання вмісту буферу обміну, також можуть бути використані для проблемних цілей, що порушують приватність.

{{витік індексів, уразливість, безпека}}

Час від часу хтось придумує новий спосіб обійти обмеження ((браузера)) і зробити щось шкідливе, починаючи від витоку незначної приватної інформації і закінчуючи захопленням всього комп'ютера, на якому запущено браузер. Розробники браузерів реагують на це, виправляючи дірку, і все знову стає добре - до тих пір, поки не буде виявлено наступну проблему, яка, сподіваємося, буде оприлюднена, а не таємно використана якоюсь державною установою або злочинною організацією.

## Сумісність та війни браузерів

{{індекс Microsoft, «World Wide Web»}}

На ранніх стадіях розвитку Інтернету на ринку домінував браузер під назвою ((Mosaic)). Через кілька років баланс змістився на користь ((Netscape)), який, у свою чергу, був значною мірою витіснений ((Internet Explorer)) від Microsoft. У будь-який момент, коли один ((браузер)) був домінуючим, постачальник цього браузера відчував себе вправі в односторонньому порядку винаходити нові функції для Інтернету. Оскільки більшість користувачів використовували найпопулярніший браузер, ((веб-сайт)) просто починав використовувати ці функції, не звертаючи уваги на інші браузери.

Це була темна доба ((сумісності)), яку часто називають _((війнами браузерів))_. Веб-розробники залишилися не з одним єдиним інтернетом, а з двома чи трьома несумісними платформами. Що ще гірше, браузери, які використовувалися близько 2003 року, були повні ((помилок)), і, звичайно, помилки були різними для кожного ((браузера)). Життя людей, які писали веб-сторінки, було важким.

{{індекс Apple, «Internet Explorer», Mozilla}}

Mozilla ((Firefox)), некомерційне відгалуження ((Netscape)), кинуло виклик позиції Internet Explorer наприкінці 2000-х років. Оскільки ((Microsoft)) не була особливо зацікавлена в тому, щоб залишатися конкурентоспроможною в той час, Firefox відібрав у неї значну частку ринку. Приблизно в той самий час ((Google)) представив свій браузер ((Chrome)), а браузер Apple ((Safari)) набув популярності, що призвело до ситуації, коли на ринку було чотири основних гравці, а не один.

{Сумісність індексів

Нові гравці серйозніше ставилися до ((стандарти)) та кращих ((інженерія)) практик, що дало нам менше несумісності та менше ((багів)). Microsoft, побачивши, що її частка на ринку зменшується, оговталася і застосувала ці підходи у своєму браузері Edge, який замінив Internet Explorer. Якщо ви починаєте вивчати веб-розробку сьогодні, вважайте, що вам пощастило. Останні версії основних браузерів поводяться досить одноманітно і мають відносно мало помилок.

На жаль, зважаючи на те, що частка Firefox на ринку стає дедалі меншою, а Edge стає лише обгорткою навколо ядра Chrome у 2018 році, ця одноманітність може знову набути форми єдиного постачальника - цього разу Google - який має достатньо контролю над ринком браузерів, щоб нав'язати решті світу своє уявлення про те, як має виглядати веб.

Як би там не було, цей довгий ланцюг історичних подій і випадковостей призвів до створення тієї веб-платформи, яку ми маємо сьогодні. У наступних розділах ми будемо писати для неї програми.
